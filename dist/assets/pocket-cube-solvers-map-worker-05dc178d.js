var nt=Object.defineProperty;var ot=(u,E,O)=>E in u?nt(u,E,{enumerable:!0,configurable:!0,writable:!0,value:O}):u[E]=O;var T=(u,E,O)=>(ot(u,typeof E!="symbol"?E+"":E,O),O);(function(){"use strict";var u=(t=>(t[t.UP=0]="UP",t[t.LEFT=1]="LEFT",t[t.FRONT=2]="FRONT",t[t.RIGHT=3]="RIGHT",t[t.BACK=4]="BACK",t[t.DOWN=5]="DOWN",t))(u||{});const E=()=>Object.keys(u).filter(t=>!isNaN(Number(t))).map(t=>Number(t)),O=t=>{switch(t){case 0:return 5;case 5:return 0;case 1:return 3;case 3:return 1;case 2:return 4;case 4:return 2}},C=class{constructor(){C.faceRotatorMap||this.initializeMap()}rotate(e,i){const n=[...e];return C.faceRotatorMap.get(i.side).forEach(a=>{i.counterClockwiseDirection?n[a.source]=e[a.destination]:n[a.destination]=e[a.source]}),n}initializeMap(){C.faceRotatorMap=new Map;const e=this.createUpFaceClockwiseRotator(),i=this.createLeftFaceClockwiseRotator(),n=this.createFrontFaceClockwiseRotator(),a=this.createRightFaceClockwiseRotator(),d=this.createBackFaceClockwiseRotator(),p=this.createDownFaceClockwiseRotator();C.faceRotatorMap.set(u.UP,e),C.faceRotatorMap.set(u.LEFT,i),C.faceRotatorMap.set(u.FRONT,n),C.faceRotatorMap.set(u.RIGHT,a),C.faceRotatorMap.set(u.BACK,d),C.faceRotatorMap.set(u.DOWN,p)}createDownFaceClockwiseRotator(){return[{destination:6,source:18},{destination:7,source:19},{destination:10,source:6},{destination:11,source:7},{destination:14,source:10},{destination:15,source:11},{destination:18,source:14},{destination:19,source:15},{destination:20,source:23},{destination:21,source:20},{destination:22,source:21},{destination:23,source:22}]}createRightFaceClockwiseRotator(){return[{destination:1,source:9},{destination:2,source:10},{destination:9,source:21},{destination:10,source:22},{destination:12,source:15},{destination:13,source:12},{destination:14,source:13},{destination:15,source:14},{destination:16,source:2},{destination:19,source:1},{destination:21,source:19},{destination:22,source:16}]}createUpFaceClockwiseRotator(){return[{destination:0,source:3},{destination:1,source:0},{destination:2,source:1},{destination:3,source:2},{destination:4,source:8},{destination:5,source:9},{destination:8,source:12},{destination:9,source:13},{destination:12,source:16},{destination:13,source:17},{destination:16,source:4},{destination:17,source:5}]}createBackFaceClockwiseRotator(){return[{destination:0,source:13},{destination:1,source:14},{destination:4,source:1},{destination:7,source:0},{destination:13,source:22},{destination:14,source:23},{destination:16,source:19},{destination:17,source:16},{destination:18,source:17},{destination:19,source:18},{destination:22,source:7},{destination:23,source:4}]}createLeftFaceClockwiseRotator(){return[{destination:0,source:18},{destination:3,source:17},{destination:4,source:7},{destination:5,source:4},{destination:6,source:5},{destination:7,source:6},{destination:8,source:0},{destination:11,source:3},{destination:17,source:23},{destination:18,source:20},{destination:20,source:8},{destination:23,source:11}]}createFrontFaceClockwiseRotator(){return[{destination:2,source:5},{destination:3,source:6},{destination:5,source:20},{destination:6,source:21},{destination:8,source:11},{destination:9,source:8},{destination:10,source:9},{destination:11,source:10},{destination:12,source:3},{destination:15,source:2},{destination:20,source:15},{destination:21,source:12}]}};let H=C;T(H,"faceRotatorMap");var A=(t=>(t[t.YELLOW=0]="YELLOW",t[t.ORANGE=1]="ORANGE",t[t.BLUE=2]="BLUE",t[t.RED=3]="RED",t[t.GREEN=4]="GREEN",t[t.WHITE=5]="WHITE",t))(A||{});const Y=t=>{switch(t){case 2:return 4;case 4:return 2;case 3:return 1;case 1:return 3;case 0:return 5;case 5:return 0}},I=new Map;I.set(u.FRONT,A.BLUE),I.set(u.UP,A.YELLOW),I.set(u.RIGHT,A.RED),I.set(u.LEFT,A.ORANGE),I.set(u.BACK,A.GREEN),I.set(u.DOWN,A.WHITE);class J{constructor(e){T(this,"hash");T(this,"stickers");T(this,"dimension");if(this.dimension=e.dimension,e.clone)this.stickers=[...e.clone];else{let i=I;e.colorMap&&(i=e.colorMap),this.stickers=[],E().forEach(n=>{const a=Array.from(new Array(this.getDimension()*this.getDimension())).map(()=>i.get(n));this.stickers.push(...a)})}this.hash=this.stickers.join(".")}getStickers(){return[...this.stickers]}getDimension(){return this.dimension}getConfiguration(){return[...this.stickers]}isSolved(){const e=this.dimension*this.dimension,i=E(),n=Array.from(new Array(e));return i.every((a,d)=>n.every((p,w)=>this.stickers[d*e+w]===this.stickers[d*e]))}getHash(){return this.hash}}const L=[[{side:u.FRONT,id:8},{side:u.LEFT,id:5},{side:u.UP,id:3}],[{side:u.FRONT,id:9},{side:u.RIGHT,id:12},{side:u.UP,id:2}],[{side:u.FRONT,id:11},{side:u.LEFT,id:6},{side:u.DOWN,id:20}],[{side:u.FRONT,id:10},{side:u.RIGHT,id:15},{side:u.DOWN,id:21}],[{side:u.BACK,id:16},{side:u.RIGHT,id:13},{side:u.UP,id:1}],[{side:u.BACK,id:17},{side:u.LEFT,id:4},{side:u.UP,id:0}],[{side:u.BACK,id:19},{side:u.RIGHT,id:14},{side:u.DOWN,id:22}],[{side:u.BACK,id:18},{side:u.LEFT,id:7},{side:u.DOWN,id:23}]];class N extends J{constructor(i){super({dimension:2,stickersMap:L,clone:i&&i.clone,colorMap:i&&(i==null?void 0:i.colorMap)});T(this,"faceRotator");this.faceRotator=new H}clone(){return new N({clone:this.stickers})}rotateFace(i){const n=this.faceRotator.rotate(this.stickers,i);return new N({clone:n})}getCubeletsBySides(...i){const n=L.filter(a=>a.every(d=>i.includes(d.side)));return this.getCubeletsFromStickers(n)}getCubeletsByColor(...i){const n=L.filter(a=>a.every(d=>i.includes(this.stickers[d.id])));return this.getCubeletsFromStickers(n)}getAllCubelets(){return this.getCubeletsFromStickers(L)}getCubeletsFromStickers(i){return i.map(n=>({stickers:n.map(a=>{const d=a.id%4===0||a.id%4===3?0:1,p=a.id%4===0||a.id%4===1?0:1;return{side:a.side,id:a.id,color:this.stickers[a.id],x:d,y:p}})}))}}var q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var P={},X={get exports(){return P},set exports(t){P=t}},U={},Z={get exports(){return U},set exports(t){U=t}};(function(t,e){(function(){var i,n,a,d,p,w,S,G,V,$,j,z,x,K,k;a=Math.floor,$=Math.min,n=function(s,o){return s<o?-1:s>o?1:0},V=function(s,o,r,c,h){var l;if(r==null&&(r=0),h==null&&(h=n),r<0)throw new Error("lo must be non-negative");for(c==null&&(c=s.length);r<c;)l=a((r+c)/2),h(o,s[l])<0?c=l:r=l+1;return[].splice.apply(s,[r,r-r].concat(o)),o},w=function(s,o,r){return r==null&&(r=n),s.push(o),K(s,0,s.length-1,r)},p=function(s,o){var r,c;return o==null&&(o=n),r=s.pop(),s.length?(c=s[0],s[0]=r,k(s,0,o)):c=r,c},G=function(s,o,r){var c;return r==null&&(r=n),c=s[0],s[0]=o,k(s,0,r),c},S=function(s,o,r){var c;return r==null&&(r=n),s.length&&r(s[0],o)<0&&(c=[s[0],o],o=c[0],s[0]=c[1],k(s,0,r)),o},d=function(s,o){var r,c,h,l,f,_;for(o==null&&(o=n),l=function(){_=[];for(var R=0,D=a(s.length/2);0<=D?R<D:R>D;0<=D?R++:R--)_.push(R);return _}.apply(this).reverse(),f=[],c=0,h=l.length;c<h;c++)r=l[c],f.push(k(s,r,o));return f},x=function(s,o,r){var c;if(r==null&&(r=n),c=s.indexOf(o),c!==-1)return K(s,0,c,r),k(s,c,r)},j=function(s,o,r){var c,h,l,f,_;if(r==null&&(r=n),h=s.slice(0,o),!h.length)return h;for(d(h,r),_=s.slice(o),l=0,f=_.length;l<f;l++)c=_[l],S(h,c,r);return h.sort(r).reverse()},z=function(s,o,r){var c,h,l,f,_,R,D,y,M;if(r==null&&(r=n),o*10<=s.length){if(l=s.slice(0,o).sort(r),!l.length)return l;for(h=l[l.length-1],D=s.slice(o),f=0,R=D.length;f<R;f++)c=D[f],r(c,h)<0&&(V(l,c,0,null,r),l.pop(),h=l[l.length-1]);return l}for(d(s,r),M=[],_=0,y=$(o,s.length);0<=y?_<y:_>y;0<=y?++_:--_)M.push(p(s,r));return M},K=function(s,o,r,c){var h,l,f;for(c==null&&(c=n),h=s[r];r>o;){if(f=r-1>>1,l=s[f],c(h,l)<0){s[r]=l,r=f;continue}break}return s[r]=h},k=function(s,o,r){var c,h,l,f,_;for(r==null&&(r=n),h=s.length,_=o,l=s[o],c=2*o+1;c<h;)f=c+1,f<h&&!(r(s[c],s[f])<0)&&(c=f),s[o]=s[c],o=c,c=2*o+1;return s[o]=l,K(s,_,o,r)},i=function(){s.push=w,s.pop=p,s.replace=G,s.pushpop=S,s.heapify=d,s.updateItem=x,s.nlargest=j,s.nsmallest=z;function s(o){this.cmp=o??n,this.nodes=[]}return s.prototype.push=function(o){return w(this.nodes,o,this.cmp)},s.prototype.pop=function(){return p(this.nodes,this.cmp)},s.prototype.peek=function(){return this.nodes[0]},s.prototype.contains=function(o){return this.nodes.indexOf(o)!==-1},s.prototype.replace=function(o){return G(this.nodes,o,this.cmp)},s.prototype.pushpop=function(o){return S(this.nodes,o,this.cmp)},s.prototype.heapify=function(){return d(this.nodes,this.cmp)},s.prototype.updateItem=function(o){return x(this.nodes,o,this.cmp)},s.prototype.clear=function(){return this.nodes=[]},s.prototype.empty=function(){return this.nodes.length===0},s.prototype.size=function(){return this.nodes.length},s.prototype.clone=function(){var o;return o=new s,o.nodes=this.nodes.slice(0),o},s.prototype.toArray=function(){return this.nodes.slice(0)},s.prototype.insert=s.prototype.push,s.prototype.top=s.prototype.peek,s.prototype.front=s.prototype.peek,s.prototype.has=s.prototype.contains,s.prototype.copy=s.prototype.clone,s}(),function(s,o){return t.exports=o()}(this,function(){return i})}).call(q)})(Z),function(t){t.exports=U}(X);var tt=Q(P);class W{constructor(){T(this,"map");T(this,"startTime");T(this,"totalTime");this.map=new Map}add(e,i){const n=new Date().getTime(),a=i(),d=new Date().getTime(),p=this.map.get(e)||{time:0,calls:0};return p.time+=d-n,p.calls++,this.map.set(e,p),a}start(){this.startTime=Date.now()}finish(){this.startTime&&(this.totalTime=Date.now()-this.startTime)}getTotalTime(){return this.totalTime}getData(e){if(this.totalTime){let i=0;const n={};return Array.from(this.map.entries()).forEach(a=>{const[d,p]=a;i+=p.time,n[d]=this.createSummary(p.time,p.calls)}),e&&(n[e]=this.createSummary(this.totalTime-i,0)),n}}createSummary(e,i){let n=`${e}ms (~${Math.trunc(1e3*e/this.totalTime)/10}%)`;return i>0&&(n+=`; calls: ${i}; avg: ~${10*Math.trunc(1e6*e*1/i)/10}ns`),n}}var v=(t=>(t[t.ADD_CANDIDATE=0]="ADD_CANDIDATE",t[t.POP_CANDIDATE=1]="POP_CANDIDATE",t[t.CHECK_SOLUTION=2]="CHECK_SOLUTION",t[t.BREATHING_TIME=3]="BREATHING_TIME",t[t.HASH_CALCULATION=4]="HASH_CALCULATION",t[t.VISISTED_LIST_CHECK=5]="VISISTED_LIST_CHECK",t[t.ADD_TO_VISISTED_LIST_CHECK=6]="ADD_TO_VISISTED_LIST_CHECK",t[t.PERFORM_ROTATION=7]="PERFORM_ROTATION",t[t.NOT_MEASURED=8]="NOT_MEASURED",t))(v||{});class et{constructor(e){T(this,"measurer");T(this,"candidates");T(this,"goalState");T(this,"visitedChecklist");T(this,"actions");this.measurer=new W,this.candidates=new tt((n,a)=>n.cost-a.cost),this.visitedChecklist=new Map;const i={cost:0,cube:e,rotation:void 0,parent:void 0};this.candidates.push(i),this.measurer.start(),this.actions=[],this.goalState=this.buildSolvedPocketCubeFromCornerCubelet(e.getCubeletsBySides(u.BACK,u.LEFT,u.DOWN)[0]),[u.FRONT,u.UP,u.RIGHT].map(n=>[!0,!1].map(a=>{this.actions.push({side:n,counterClockwiseDirection:a,layer:0})}))}findSolution(){let e,i=0;for(;this.candidates.size()>0;)if(++i,e=this.measurer.add(v[1],()=>this.candidates.pop()),!this.measurer.add(v[5],()=>this.visitedChecklist.has(e.cube.getHash()))){if(this.measurer.add(v[2],()=>e.cube.isSolved()))return this.measurer.finish(),this.candidates.clear(),this.createSolution(e,i);this.measurer.add(v[6],()=>this.visitedChecklist.set(e.cube.getHash(),!0)),this.applyRotations(e)}}createSolution(e,i){const n=[];let a=e;for(;a&&a.rotation;)n.unshift(a.rotation),a=a.parent;return{rotations:n,totalTime:this.measurer.getTotalTime(),data:{metrics:this.measurer.getData(v[8]),iterations:i}}}applyRotations(e){this.actions.forEach(i=>{const n=this.measurer.add(v[7],()=>e.cube.rotateFace(i));this.measurer.add(v[5],()=>this.visitedChecklist.has(n.getHash()))||this.measurer.add(v[0],()=>{this.candidates.push({cost:e.cost+1+this.calculateDistanceToFinalState(n),cube:n,rotation:i,parent:e})})})}calculateDistanceToFinalState(e){return e.getAllCubelets().reduce((n,a)=>{const d=this.goalState.getCubeletsByColor(...a.stickers.map(p=>p.color))[0];return n+a.stickers.reduce((p,w)=>d.stickers.some(S=>S.side===w.side)?p-1:p,a.stickers.length)},0)/4}buildSolvedPocketCubeFromCornerCubelet(e){const i=new Map;return e.stickers.forEach(n=>{i.set(n.side,n.color),i.set(O(n.side),Y(n.color))}),new N({colorMap:i})}}var st=m;function m(){this._start=null,this._end=null,this.length=0}m.prototype.unShift=function(t){if(this._start===null)this._start=F(t),this._end=this._start;else{var e=this._start;this._start.previous=F(t),this._start=this._start.previous,this._start.next=e}this.length++},m.prototype.push=function(t){if(this._start===null)this._start=F(t),this._end=this._start;else{var e=this._end;this._end.next=F(t),this._end=this._end.next,this._end.previous=e}this.length++},m.prototype.add=function(t,e){if(t%1===0)if(t<=0)this.unShift(e);else if(t>=this.length)this.push(e);else{var i=B.call(this,t);if(i){var n=i.previous,a=i,d=F(e);d.previous=n,n.next=d,d.next=a,a.previous=d,this.length++}}},m.prototype.shift=function(){if(this._start){var t=this._start.data;return this._start.next===null?(this._end=null,this._start=null):(this._start=this._start.next,this._start.previous=null),this.length--,t}else return},m.prototype.pop=function(){if(this._end){var t=this._end.data;return this._end.previous===null?(this._end=null,this._start=null):(this._end=this._end.previous,this._end.next=null),this.length--,t}else return},m.prototype.remove=function(t){if(t===0)return this.shift();if(t===this.length-1)return this.pop();var e=B.call(this,t);if(e){var i=e.previous,n=e.next;i.next=n,n.previous=i,this.length--}else return},m.prototype.first=function(){if(this._start)return this._start.data},m.prototype.last=function(){if(this._end)return this._end.data},m.prototype.get=function(t){var e=B.call(this,t);if(e)return e.data},m.prototype.toString=function(){for(var t=this._start,e="",i=0;i<this.length;i++)typeof t.data=="object"?e+=JSON.stringify(t.data):e+=t.data,i!==this.length-1&&(e+=", "),t=t.next;return e};function F(t){return{data:t,previous:null,next:null}}function B(t){var e,i;if(t>=this.length||t<0||t%1!==0)e=null;else if(t<this.length/2)for(e=this._start,i=0;i<t;i++)e=e.next;else for(e=this._end,i=this.length-1;i>t;i--)e=e.previous;return e}var g=(t=>(t[t.ADD_CANDIDATE=0]="ADD_CANDIDATE",t[t.POP_CANDIDATE=1]="POP_CANDIDATE",t[t.CHECK_SOLUTION=2]="CHECK_SOLUTION",t[t.BREATHING_TIME=3]="BREATHING_TIME",t[t.HASH_CALCULATION=4]="HASH_CALCULATION",t[t.VISISTED_LIST_CHECK=5]="VISISTED_LIST_CHECK",t[t.ADD_TO_VISISTED_LIST_CHECK=6]="ADD_TO_VISISTED_LIST_CHECK",t[t.PERFORM_ROTATION=7]="PERFORM_ROTATION",t[t.NOT_MEASURED=8]="NOT_MEASURED",t))(g||{});class it{constructor(e){T(this,"measurer");T(this,"candidates");T(this,"visitedChecklist");T(this,"actions");this.measurer=new W,this.visitedChecklist=new Map,this.candidates=new st;const i={cube:e,rotation:void 0,parent:void 0};this.candidates.push(i),this.measurer.start(),this.actions=[],[u.FRONT,u.UP,u.RIGHT].map(n=>[!0,!1].map(a=>{this.actions.push({side:n,counterClockwiseDirection:a,layer:0})}))}findSolution(){let e,i=0;for(;this.candidates.length>0;)if(++i,e=this.measurer.add(g[1],()=>this.candidates.shift()),!this.measurer.add(g[5],()=>this.visitedChecklist.has(e.cube.getHash()))){if(this.measurer.add(g[2],()=>e.cube.isSolved()))return this.measurer.finish(),this.createSolution(e,i);this.measurer.add(g[6],()=>this.visitedChecklist.set(e.cube.getHash(),!0)),this.applyRotations(e)}}createSolution(e,i){const n=[];let a=e;for(;a&&a.rotation;)n.unshift(a.rotation),a=a.parent;return{rotations:n,totalTime:this.measurer.getTotalTime(),data:{metrics:this.measurer.getData(g[8]),iterations:i}}}applyRotations(e){this.actions.forEach(i=>{const n=this.measurer.add(g[7],()=>e.cube.rotateFace(i));this.measurer.add(g[5],()=>this.visitedChecklist.has(n.getHash()))||this.measurer.add(g[0],()=>{this.candidates.push({cube:n,rotation:i,parent:e})})})}}const b=new Map;b.set("a*".toLowerCase(),t=>new et(t)),b.set("bfs".toLowerCase(),t=>new it(t)),self.onmessage=t=>{if(b.has(t.data.solverKey.toLowerCase())){const e=new N({clone:t.data.cube}),n=b.get(t.data.solverKey.toLowerCase())(e).findSolution();self.postMessage({solution:JSON.stringify(n),solverKey:t.data.solverKey,id:t.data.id})}else self.postMessage({error:`Solution for ${t.data.solverKey} found`,solverKey:t.data.solverKey,id:t.data.id})}})();
