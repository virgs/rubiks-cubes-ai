var at=Object.defineProperty;var ut=(a,v,I)=>v in a?at(a,v,{enumerable:!0,configurable:!0,writable:!0,value:I}):a[v]=I;var p=(a,v,I)=>(ut(a,typeof v!="symbol"?v+"":v,I),I);(function(){"use strict";var a=(t=>(t[t.UP=0]="UP",t[t.LEFT=1]="LEFT",t[t.FRONT=2]="FRONT",t[t.RIGHT=3]="RIGHT",t[t.BACK=4]="BACK",t[t.DOWN=5]="DOWN",t))(a||{});const v=()=>Object.keys(a).filter(t=>!isNaN(Number(t))).map(t=>Number(t)),I=t=>{switch(t){case 0:return 5;case 5:return 0;case 1:return 3;case 3:return 1;case 2:return 4;case 4:return 2}},C=class{constructor(){C.faceRotatorMap||this.initializeMap()}static setColorOfIndex(e,s,i){e.forEach((u,d,f)=>{d===i?f[d]|=1<<s:f[d]&=-1^1<<s})}static getColorOfIndex(e,s){let i=0;for(let u of e){if(u&1<<s)return i;++i}}rotate(e,s){const i=[...e];return C.faceRotatorMap.get(s.side).forEach(u=>{s.counterClockwiseDirection?C.setColorOfIndex(i,u.source,C.getColorOfIndex(e,u.destination)):C.setColorOfIndex(i,u.destination,C.getColorOfIndex(e,u.source))}),i}initializeMap(){C.faceRotatorMap=new Map;const e=this.createUpFaceClockwiseRotator(),s=this.createLeftFaceClockwiseRotator(),i=this.createFrontFaceClockwiseRotator(),u=this.createRightFaceClockwiseRotator(),d=this.createBackFaceClockwiseRotator(),f=this.createDownFaceClockwiseRotator();C.faceRotatorMap.set(a.UP,e),C.faceRotatorMap.set(a.LEFT,s),C.faceRotatorMap.set(a.FRONT,i),C.faceRotatorMap.set(a.RIGHT,u),C.faceRotatorMap.set(a.BACK,d),C.faceRotatorMap.set(a.DOWN,f)}createDownFaceClockwiseRotator(){return[{destination:6,source:18},{destination:7,source:19},{destination:10,source:6},{destination:11,source:7},{destination:14,source:10},{destination:15,source:11},{destination:18,source:14},{destination:19,source:15},{destination:20,source:23},{destination:21,source:20},{destination:22,source:21},{destination:23,source:22}]}createRightFaceClockwiseRotator(){return[{destination:1,source:9},{destination:2,source:10},{destination:9,source:21},{destination:10,source:22},{destination:12,source:15},{destination:13,source:12},{destination:14,source:13},{destination:15,source:14},{destination:16,source:2},{destination:19,source:1},{destination:21,source:19},{destination:22,source:16}]}createUpFaceClockwiseRotator(){return[{destination:0,source:3},{destination:1,source:0},{destination:2,source:1},{destination:3,source:2},{destination:4,source:8},{destination:5,source:9},{destination:8,source:12},{destination:9,source:13},{destination:12,source:16},{destination:13,source:17},{destination:16,source:4},{destination:17,source:5}]}createBackFaceClockwiseRotator(){return[{destination:0,source:13},{destination:1,source:14},{destination:4,source:1},{destination:7,source:0},{destination:13,source:22},{destination:14,source:23},{destination:16,source:19},{destination:17,source:16},{destination:18,source:17},{destination:19,source:18},{destination:22,source:7},{destination:23,source:4}]}createLeftFaceClockwiseRotator(){return[{destination:0,source:18},{destination:3,source:17},{destination:4,source:7},{destination:5,source:4},{destination:6,source:5},{destination:7,source:6},{destination:8,source:0},{destination:11,source:3},{destination:17,source:23},{destination:18,source:20},{destination:20,source:8},{destination:23,source:11}]}createFrontFaceClockwiseRotator(){return[{destination:2,source:5},{destination:3,source:6},{destination:5,source:20},{destination:6,source:21},{destination:8,source:11},{destination:9,source:8},{destination:10,source:9},{destination:11,source:10},{destination:12,source:3},{destination:15,source:2},{destination:20,source:15},{destination:21,source:12}]}};let N=C;p(N,"faceRotatorMap");var w=(t=>(t[t.YELLOW=0]="YELLOW",t[t.ORANGE=1]="ORANGE",t[t.BLUE=2]="BLUE",t[t.RED=3]="RED",t[t.GREEN=4]="GREEN",t[t.WHITE=5]="WHITE",t))(w||{});const J=t=>{switch(t){case 2:return 4;case 4:return 2;case 3:return 1;case 1:return 3;case 0:return 5;case 5:return 0}},D=new Map;D.set(a.FRONT,w.BLUE),D.set(a.UP,w.YELLOW),D.set(a.RIGHT,w.RED),D.set(a.LEFT,w.ORANGE),D.set(a.BACK,w.GREEN),D.set(a.DOWN,w.WHITE);const x=[[{side:a.FRONT,id:8},{side:a.LEFT,id:5},{side:a.UP,id:3}],[{side:a.FRONT,id:9},{side:a.RIGHT,id:12},{side:a.UP,id:2}],[{side:a.FRONT,id:11},{side:a.LEFT,id:6},{side:a.DOWN,id:20}],[{side:a.FRONT,id:10},{side:a.RIGHT,id:15},{side:a.DOWN,id:21}],[{side:a.BACK,id:16},{side:a.RIGHT,id:13},{side:a.UP,id:1}],[{side:a.BACK,id:17},{side:a.LEFT,id:4},{side:a.UP,id:0}],[{side:a.BACK,id:19},{side:a.RIGHT,id:14},{side:a.DOWN,id:22}],[{side:a.BACK,id:18},{side:a.LEFT,id:7},{side:a.DOWN,id:23}]];class A{constructor(e){p(this,"hash");p(this,"configuration");p(this,"dimension");p(this,"faceRotator");if(this.faceRotator=new N,this.dimension=2,e!=null&&e.clone)this.configuration=[...e.clone];else{const s=(e==null?void 0:e.colorMap)||D;this.configuration=v().map(i=>15<<s.get(i)*4)}this.hash=this.configuration.join(".")}clone(){return new A({clone:this.configuration})}getDimension(){return this.dimension}getConfiguration(){return[...this.configuration]}getHash(){return this.hash}getColorOfIndex(e){let s=0;for(let i of this.configuration){if(i&1<<e)return s;++s}}isSolved(){const e=this.dimension*this.dimension,s=v(),i=Array.from(new Array(e));return s.every((u,d)=>i.every((f,S)=>this.getColorOfIndex(d*e+S)===this.getColorOfIndex(d*e)))}rotateFace(e){const s=this.faceRotator.rotate(this.configuration,e);return new A({clone:s})}getCubeletsBySides(...e){const s=x.filter(i=>i.every(u=>e.includes(u.side)));return this.getCubeletsFromStickers(s)}getCubeletsByColor(...e){const s=x.filter(i=>i.every(u=>e.includes(this.getColorOfIndex(u.id))));return this.getCubeletsFromStickers(s)}getAllCubelets(){return this.getCubeletsFromStickers(x)}getCubeletsFromStickers(e){return e.map(s=>({stickers:s.map(i=>{const u=i.id%4===0||i.id%4===3?0:1,d=i.id%4===0||i.id%4===1?0:1;return{side:i.side,id:i.id,color:this.getColorOfIndex(i.id),x:u,y:d}})}))}}class X{readKeys(e){let s;switch(e.key.toLowerCase()){case"w":s=a.UP;break;case"a":s=a.LEFT;break;case"s":s=a.FRONT;break;case"d":s=a.RIGHT;break;case"f":s=a.BACK;break;case"x":s=a.DOWN;break}if(s!==void 0)return{side:s,counterClockwiseDirection:e.shiftKey}}}class M{constructor(e){p(this,"moves");p(this,"cube");p(this,"findSolutionResolve");p(this,"startTime");p(this,"keyboardInterpreter");this.cube=e,this.moves=[],this.keyboardInterpreter=new X}async findSolution(){return this.startTime=Date.now(),new Promise(e=>{this.findSolutionResolve=e})}async readKeys(e){if(this.cube.isSolved())return;const s=this.keyboardInterpreter.readKeys(e);if(s!==void 0)return this.moves.push(s),this.cube=this.cube.rotateFace(s),this.cube.isSolved()&&this.findSolutionResolve({rotations:this.moves,totalTime:Date.now()-this.startTime,data:{human:!0}}),s}}var Q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var P={},q={get exports(){return P},set exports(t){P=t}},K={},tt={get exports(){return K},set exports(t){K=t}};(function(t,e){(function(){var s,i,u,d,f,S,y,B,V,z,j,Y,G,L,b;u=Math.floor,z=Math.min,i=function(n,o){return n<o?-1:n>o?1:0},V=function(n,o,r,c,h){var l;if(r==null&&(r=0),h==null&&(h=i),r<0)throw new Error("lo must be non-negative");for(c==null&&(c=n.length);r<c;)l=u((r+c)/2),h(o,n[l])<0?c=l:r=l+1;return[].splice.apply(n,[r,r-r].concat(o)),o},S=function(n,o,r){return r==null&&(r=i),n.push(o),L(n,0,n.length-1,r)},f=function(n,o){var r,c;return o==null&&(o=i),r=n.pop(),n.length?(c=n[0],n[0]=r,b(n,0,o)):c=r,c},B=function(n,o,r){var c;return r==null&&(r=i),c=n[0],n[0]=o,b(n,0,r),c},y=function(n,o,r){var c;return r==null&&(r=i),n.length&&r(n[0],o)<0&&(c=[n[0],o],o=c[0],n[0]=c[1],b(n,0,r)),o},d=function(n,o){var r,c,h,l,T,m;for(o==null&&(o=i),l=function(){m=[];for(var E=0,O=u(n.length/2);0<=O?E<O:E>O;0<=O?E++:E--)m.push(E);return m}.apply(this).reverse(),T=[],c=0,h=l.length;c<h;c++)r=l[c],T.push(b(n,r,o));return T},G=function(n,o,r){var c;if(r==null&&(r=i),c=n.indexOf(o),c!==-1)return L(n,0,c,r),b(n,c,r)},j=function(n,o,r){var c,h,l,T,m;if(r==null&&(r=i),h=n.slice(0,o),!h.length)return h;for(d(h,r),m=n.slice(o),l=0,T=m.length;l<T;l++)c=m[l],y(h,c,r);return h.sort(r).reverse()},Y=function(n,o,r){var c,h,l,T,m,E,O,F,W;if(r==null&&(r=i),o*10<=n.length){if(l=n.slice(0,o).sort(r),!l.length)return l;for(h=l[l.length-1],O=n.slice(o),T=0,E=O.length;T<E;T++)c=O[T],r(c,h)<0&&(V(l,c,0,null,r),l.pop(),h=l[l.length-1]);return l}for(d(n,r),W=[],m=0,F=z(o,n.length);0<=F?m<F:m>F;0<=F?++m:--m)W.push(f(n,r));return W},L=function(n,o,r,c){var h,l,T;for(c==null&&(c=i),h=n[r];r>o;){if(T=r-1>>1,l=n[T],c(h,l)<0){n[r]=l,r=T;continue}break}return n[r]=h},b=function(n,o,r){var c,h,l,T,m;for(r==null&&(r=i),h=n.length,m=o,l=n[o],c=2*o+1;c<h;)T=c+1,T<h&&!(r(n[c],n[T])<0)&&(c=T),n[o]=n[c],o=c,c=2*o+1;return n[o]=l,L(n,m,o,r)},s=function(){n.push=S,n.pop=f,n.replace=B,n.pushpop=y,n.heapify=d,n.updateItem=G,n.nlargest=j,n.nsmallest=Y;function n(o){this.cmp=o??i,this.nodes=[]}return n.prototype.push=function(o){return S(this.nodes,o,this.cmp)},n.prototype.pop=function(){return f(this.nodes,this.cmp)},n.prototype.peek=function(){return this.nodes[0]},n.prototype.contains=function(o){return this.nodes.indexOf(o)!==-1},n.prototype.replace=function(o){return B(this.nodes,o,this.cmp)},n.prototype.pushpop=function(o){return y(this.nodes,o,this.cmp)},n.prototype.heapify=function(){return d(this.nodes,this.cmp)},n.prototype.updateItem=function(o){return G(this.nodes,o,this.cmp)},n.prototype.clear=function(){return this.nodes=[]},n.prototype.empty=function(){return this.nodes.length===0},n.prototype.size=function(){return this.nodes.length},n.prototype.clone=function(){var o;return o=new n,o.nodes=this.nodes.slice(0),o},n.prototype.toArray=function(){return this.nodes.slice(0)},n.prototype.insert=n.prototype.push,n.prototype.top=n.prototype.peek,n.prototype.front=n.prototype.peek,n.prototype.has=n.prototype.contains,n.prototype.copy=n.prototype.clone,n}(),function(n,o){return t.exports=o()}(this,function(){return s})}).call(Q)})(tt),function(t){t.exports=K}(q);var et=Z(P);class ${constructor(){p(this,"map");p(this,"startTime");p(this,"totalTime");this.map=new Map}add(e,s){const i=new Date().getTime(),u=s(),d=new Date().getTime(),f=this.map.get(e)||{time:0,calls:0};return f.time+=d-i,f.calls++,this.map.set(e,f),u}start(){this.startTime=Date.now()}finish(){this.startTime&&(this.totalTime=Date.now()-this.startTime)}getTotalTime(){return this.totalTime}getData(e){if(this.totalTime){let s=0;const i={};return Array.from(this.map.entries()).forEach(u=>{const[d,f]=u;s+=f.time,i[d]=this.createSummary(f.time,f.calls)}),e&&(i[e]=this.createSummary(this.totalTime-s,0)),i}}createSummary(e,s){let i=`${e}ms (~${Math.trunc(1e3*e/this.totalTime)/10}%)`;return s>0&&(i+=`; calls: ${s}; avg: ~${10*Math.trunc(1e6*e*1/s)/10}ns`),i}}var _=(t=>(t[t.ADD_CANDIDATE=0]="ADD_CANDIDATE",t[t.POP_CANDIDATE=1]="POP_CANDIDATE",t[t.CHECK_SOLUTION=2]="CHECK_SOLUTION",t[t.BREATHING_TIME=3]="BREATHING_TIME",t[t.HASH_CALCULATION=4]="HASH_CALCULATION",t[t.VISISTED_LIST_CHECK=5]="VISISTED_LIST_CHECK",t[t.ADD_TO_VISISTED_LIST_CHECK=6]="ADD_TO_VISISTED_LIST_CHECK",t[t.PERFORM_ROTATION=7]="PERFORM_ROTATION",t[t.NOT_MEASURED=8]="NOT_MEASURED",t))(_||{});class st{constructor(e){p(this,"measurer");p(this,"candidates");p(this,"goalState");p(this,"visitedChecklist");p(this,"actions");this.measurer=new $,this.candidates=new et((i,u)=>i.cost-u.cost),this.visitedChecklist=new Map;const s={cost:0,cube:e,rotation:void 0,parent:void 0};this.candidates.push(s),this.actions=[],this.goalState=this.buildSolvedPocketCubeFromCornerCubelet(e.getCubeletsBySides(a.BACK,a.LEFT,a.DOWN)[0]),[a.FRONT,a.UP,a.RIGHT].map(i=>[!0,!1].map(u=>{this.actions.push({side:i,counterClockwiseDirection:u,layer:0})}))}async findSolution(){return new Promise(e=>{this.measurer.start();let s,i=0;for(;this.candidates.size()>0;)if(++i,s=this.measurer.add(_[1],()=>this.candidates.pop()),!this.measurer.add(_[5],()=>this.visitedChecklist.has(s.cube.getHash()))){if(this.measurer.add(_[2],()=>s.cube.isSolved()))return this.measurer.finish(),this.candidates.clear(),e(this.createSolution(s,i));this.measurer.add(_[6],()=>this.visitedChecklist.set(s.cube.getHash(),!0)),this.applyRotations(s)}})}createSolution(e,s){const i=[];let u=e;for(;u&&u.rotation;)i.unshift(u.rotation),u=u.parent;return{rotations:i,totalTime:this.measurer.getTotalTime(),data:{metrics:this.measurer.getData(_[8]),iterations:s}}}applyRotations(e){this.actions.forEach(s=>{const i=this.measurer.add(_[7],()=>e.cube.rotateFace(s));this.measurer.add(_[5],()=>this.visitedChecklist.has(i.getHash()))||this.measurer.add(_[0],()=>{this.candidates.push({cost:e.cost+1+this.calculateDistanceToFinalState(i),cube:i,rotation:s,parent:e})})})}calculateDistanceToFinalState(e){return e.getAllCubelets().reduce((i,u)=>{const d=this.goalState.getCubeletsByColor(...u.stickers.map(f=>f.color))[0];return i+u.stickers.reduce((f,S)=>d.stickers.some(y=>y.side===S.side)?f-1:f,u.stickers.length)},0)/4}buildSolvedPocketCubeFromCornerCubelet(e){const s=new Map;return e.stickers.forEach(i=>{s.set(i.side,i.color),s.set(I(i.side),J(i.color))}),new A({colorMap:s})}}var it=g;function g(){this._start=null,this._end=null,this.length=0}g.prototype.unShift=function(t){if(this._start===null)this._start=k(t),this._end=this._start;else{var e=this._start;this._start.previous=k(t),this._start=this._start.previous,this._start.next=e}this.length++},g.prototype.push=function(t){if(this._start===null)this._start=k(t),this._end=this._start;else{var e=this._end;this._end.next=k(t),this._end=this._end.next,this._end.previous=e}this.length++},g.prototype.add=function(t,e){if(t%1===0)if(t<=0)this.unShift(e);else if(t>=this.length)this.push(e);else{var s=U.call(this,t);if(s){var i=s.previous,u=s,d=k(e);d.previous=i,i.next=d,d.next=u,u.previous=d,this.length++}}},g.prototype.shift=function(){if(this._start){var t=this._start.data;return this._start.next===null?(this._end=null,this._start=null):(this._start=this._start.next,this._start.previous=null),this.length--,t}else return},g.prototype.pop=function(){if(this._end){var t=this._end.data;return this._end.previous===null?(this._end=null,this._start=null):(this._end=this._end.previous,this._end.next=null),this.length--,t}else return},g.prototype.remove=function(t){if(t===0)return this.shift();if(t===this.length-1)return this.pop();var e=U.call(this,t);if(e){var s=e.previous,i=e.next;s.next=i,i.previous=s,this.length--}else return},g.prototype.first=function(){if(this._start)return this._start.data},g.prototype.last=function(){if(this._end)return this._end.data},g.prototype.get=function(t){var e=U.call(this,t);if(e)return e.data},g.prototype.toString=function(){for(var t=this._start,e="",s=0;s<this.length;s++)typeof t.data=="object"?e+=JSON.stringify(t.data):e+=t.data,s!==this.length-1&&(e+=", "),t=t.next;return e};function k(t){return{data:t,previous:null,next:null}}function U(t){var e,s;if(t>=this.length||t<0||t%1!==0)e=null;else if(t<this.length/2)for(e=this._start,s=0;s<t;s++)e=e.next;else for(e=this._end,s=this.length-1;s>t;s--)e=e.previous;return e}var R=(t=>(t[t.ADD_CANDIDATE=0]="ADD_CANDIDATE",t[t.POP_CANDIDATE=1]="POP_CANDIDATE",t[t.CHECK_SOLUTION=2]="CHECK_SOLUTION",t[t.BREATHING_TIME=3]="BREATHING_TIME",t[t.HASH_CALCULATION=4]="HASH_CALCULATION",t[t.VISISTED_LIST_CHECK=5]="VISISTED_LIST_CHECK",t[t.ADD_TO_VISISTED_LIST_CHECK=6]="ADD_TO_VISISTED_LIST_CHECK",t[t.PERFORM_ROTATION=7]="PERFORM_ROTATION",t[t.NOT_MEASURED=8]="NOT_MEASURED",t))(R||{});class nt{constructor(e){p(this,"measurer");p(this,"candidates");p(this,"visitedChecklist");p(this,"actions");this.measurer=new $,this.visitedChecklist=new Map,this.candidates=new it;const s={cube:e,rotation:void 0,parent:void 0};this.candidates.push(s),this.actions=[],[a.FRONT,a.UP,a.RIGHT].map(i=>[!0,!1].map(u=>{this.actions.push({side:i,counterClockwiseDirection:u,layer:0})}))}async findSolution(){return new Promise(e=>{this.measurer.start();let s,i=0;for(;this.candidates.length>0;)if(++i,s=this.measurer.add(R[1],()=>this.candidates.shift()),!this.measurer.add(R[5],()=>this.visitedChecklist.has(s.cube.getHash()))){if(this.measurer.add(R[2],()=>s.cube.isSolved()))return this.measurer.finish(),e(this.createSolution(s,i));this.measurer.add(R[6],()=>this.visitedChecklist.set(s.cube.getHash(),!0)),this.applyRotations(s)}})}createSolution(e,s){const i=[];let u=e;for(;u&&u.rotation;)i.unshift(u.rotation),u=u.parent;return{rotations:i,totalTime:this.measurer.getTotalTime(),data:{metrics:this.measurer.getData(R[8]),iterations:s}}}applyRotations(e){this.actions.forEach(s=>{const i=this.measurer.add(R[7],()=>e.cube.rotateFace(s));this.measurer.add(R[5],()=>this.visitedChecklist.has(i.getHash()))||this.measurer.add(R[0],()=>{this.candidates.push({cube:i,rotation:s,parent:e})})})}}const ot={world:{debug:!1,scrambleMoves:20,scrambleRotationDuration:100,cubesCircleRay:5},renderers:{translationDuration:500,rotationDuration:300,titleDistance:8.5,cubeSize:2.5},solvers:[{dimension:"2x2",methods:[{key:"Human",instantiator:t=>new M(new A({clone:t})),checked:!1,info:"Use keys WASDFX combined with shift to rotate cube faces"},{key:"BFS",instantiator:t=>new nt(new A({clone:t})),checked:!1},{key:"A*",instantiator:t=>new st(new A({clone:t})),checked:!0}]},{dimension:"3x3",methods:[]},{dimension:"4x4",methods:[]}]},rt=t=>{for(let e of ot.solvers)if(e.dimension.toLowerCase()===t.dimension.toLowerCase()){for(let s of e.methods)if(s.key.toLowerCase()===t.solverTag.toLowerCase())return s;return}};let H;self.onmessage=async t=>{const e=t.data.solverTag.toLowerCase(),s=rt(t.data);if(e&&s)if(t.data.cube){H=s.instantiator(t.data.cube);const i=await H.findSolution();self.postMessage({solution:JSON.stringify(i),solverKey:e})}else if(t.data.keyboardEvent){if(H instanceof M){const i=await H.readKeys(t.data.keyboardEvent);i!==void 0&&self.postMessage({faceRotation:i,solverKey:e})}}else self.postMessage({error:`Command for '${t.data}' not found`,solverTag:t.data.solverTag});else self.postMessage({error:`Solver '${t.data.solverTag}' not found`,solverTag:t.data.solverTag})}})();
